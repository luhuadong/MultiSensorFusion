# ASENSING_INS570_Driver



ASENSING_INS570_Driver 是一个采集 INS570D 传感器（车载高精度组合导航系统）数据，并对采集的数据进行解析和存储的驱动软件包。



## INS570D 简介

INS570D 是导远电子（Asensing）推出的一款基于 MEMS 惯性导航技术、融合卫星导航（支持 RTK）和车辆信息（轮速、档位等）、满足车规级标准设计和制造的高性能组合导航定位产品。

利用 INS570D，车辆可以在高速路、地库、高架桥、隧道、城市街道、港口等场景得到准确的位置、速度、姿态、航向等信息，实现更高级的智能驾驶。



## 目录结构

| 目录 | 说明                   | 备注                          |
| ---- | ---------------------- | ----------------------------- |
| src  | INS 驱动软件包的源代码 | 编译成库（libINS570Driver.a） |
| demo | INS 示例程序           | 编译成可执行文件              |



## 编译运行

工程使用 CMake 管理，进入 ASENSING_INS570_Driver 目录，执行下列命令即可编译。

```bash
mkdir build
cd build/
cmake ..
make
```

demo 目录下提供了几个简单的测试程序。

- INS570D_Dump：以十六进制形式打印 INS 数据
- INS570D_Print：以人类可阅读形式打印 INS 数据
- INS570D_Record：将 INS 数据存储到文件

由于程序运行时需要打开串口设备，因此会存在权限问题，你可以在命令前面添加 `sudo` 提权，或者执行下面命令将当前用户（非 root 用户）添加到 dialout 用户组，然后重启系统使之生效。

```bash
sudo usermod -a -G dialout $USER
```


## 通信接口

INS570 产品具有多个输入输出接口，各接口说明如下表所示。

| 接口         | 说明                                                | 配置参数                                                  |
| ------------ | --------------------------------------------------- | --------------------------------------------------------- |
| RS422 数据口 | 输出 INS 数据（数据帧 BD DB 0B）                    | 默认波特率 230400，速率 100Hz                             |
| RS232 差分口 | 接差分数据输入，GPGGA/GPRMC 输出                    | 波特率可配，默认 115200                                   |
| CAN1 口      | 输入车辆（四轮轮速、档位等）信号，默认输出 INS 信息 | 默认波特率为 500k，模式 Motorola                          |
| CAN2 口      | 输入车辆（四轮轮速、档位等）信号，无输出            | 默认波特率为 500k，模式 Motorola                          |
| PPS 接口     | 输出 PPS 脉冲                                       | 默认上升沿触发、幅值 5V、周期 1s、脉宽 1ms，驱动电流 20mA |

注意：CAN1 和 CAN2 不可同时接入底盘；CAN1 无阻抗，CAN2 含 120Ω 阻抗。



## 数据格式

INS 数据从 RS422 串口输出，数据帧以 `BD DB 0B` 开头，具体格式定义如下表所示。

| 偏移 | 定义      | 格式  | 长度 | 系数      | 单位  | 字节序    | 说明                                                         |
| ---- | --------- | ----- | ---- | --------- | ----- | --------- | ------------------------------------------------------------ |
| 0    | `0xBD`    | `U8`  | 1    |           |       |           |                                                              |
| 1    | `0xDB`    | `U8`  | 1    |           |       |           |                                                              |
| 2    | `0x0B`    | `U8`  | 1    |           |       |           |                                                              |
| 3    | 横滚角    | `I16` | 2    | 360/32768 | deg   | LSB_first | [-90, 90]，车体右倾为正                                      |
| 5    | 俯仰角    | `I16` | 2    | 360/32768 | deg   | LSB_first | [-180, 180]，车体抬头为正                                    |
| 7    | 方位角    | `I16` | 2    | 360/32768 | deg   | LSB_first | [-180, 180]，正北顺时针到正南为正 0-180°                     |
| 9    | 陀螺 x 轴 | `I16` | 2    | 300/32768 | deg/s | LSB_first | [-250, 250]，顺时针旋转为正                                  |
| 11   | 陀螺 y 轴 | `I16` | 2    | 300/32768 | deg/s | LSB_first | 同上                                                         |
| 13   | 陀螺 z 轴 | `I16` | 2    | 300/32768 | deg/s | LSB_first | 同上                                                         |
| 15   | 加表 x 轴 | `I16` | 2    | 12/32768  | g     | LSB_first | 与量程 X 有关，取值范围 [-X, X]<br/>如量程为 4g，则取值范围 [-4, 4]<br/>正向为正，g = 9.7883105 m/s2 |
| 17   | 加表 y 轴 | `I16` | 2    | 12/32768  | g     | LSB_first | 同上                                                         |
| 19   | 加表 z 轴 | `I16` | 2    | 12/32768  | g     | LSB_first | 同上                                                         |
| 21   | 纬度      | `I32` | 4    | 1.00E-07  | deg   | LSB_first | [-90, 90]，正为 N 半球                                       |
| 25   | 经度      | `I32` | 4    | 1.00E-07  | deg   | LSB_first | [-180, 180]，正为 E 半球                                     |
| 29   | 高度      | `I32` | 4    | 1.00E-03  | m     | LSB_first |                                                              |
| 33   | 北向速度  | `I16` | 2    | 1e2/32768 | m/s   | LSB_first |                                                              |
| 35   | 东向速度  | `I16` | 2    | 1e2/32768 | m/s   | LSB_first |                                                              |
| 37   | 地向速度  | `I16` | 2    | 1e2/32768 | m/s   | LSB_first |                                                              |
| 39   | 状态      | `U8`  | 1    |           |       |           | bit0：位置<br/>bit1：速度<br/>bit2：姿态<br/>bit3：航向角<br/>以上为 1 表示完成初对准 |
| 46   | Data1     | `I16` | 2    |           |       | LSB_first | 轮循数据（参考轮循数据表）                                   |
| 48   | Data2     | `I16` | 2    |           |       | LSB_first | 同上                                                         |
| 50   | Data3     | `I16` | 2    |           |       | LSB_first | 同上                                                         |
| 52   | 时间      | `U32` | 4    | 0.25      | 毫秒  | LSB_first | GPS 时间（周内秒），毫秒                                     |
| 56   | Type      | `U8`  | 1    |           |       |           | 轮循数据类型（参考轮循数据表）                               |
| 57   | 校验位    | `U8`  | 1    |           |       |           | 异或校验，包括 0~56 的数据                                   |
| 58   | GPS 周    | `U32` | 4    |           |       |           |                                                              |
| 62   | 校验位    | `U8`  | 1    |           |       |           | 异或校验，包括 0~61 的数据                                   |

